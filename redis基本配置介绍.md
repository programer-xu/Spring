### redis干货分享

redis是一个key-value存储系统，相比传统的关系型数据库，拥有高性能的特点，源于redis大部分数据缓存在内存中，读写性能非常高。但数据安全性较关系型数据库低，在存储系统发生故障时会丢失一部分数据，且不可恢复。所以redis不能提供强一致性，只能保证最终一致性

Redis支持的数据类型（五种）：String（字符串、整数、浮点数）、List（列表）、Set（无序集合，不可重复）、Hash（无序散列表）、Zset（有序集合）

主要运用场景：登录服务和cookies缓存、购物车、投票（社交点赞）、共享session

### Redis持久化方案（两种）：

### RDB（快照）持久化：

快照是默认的持久化方式。这种方式是就是将内存中数据以快照的方式写入到二进制文件中,默认的文件名为dump.rdb。可以通过配置设置自动做快照持久化的方式。我们可以配置redis在n秒内如果超过m个key被修改就自动做快照，下面是默认的快照保存配置

```xshell
save 900 1  #900秒内如果超过1个key被修改，则发起快照保存
save 300 10 #300秒内容如超过10个key被修改，则发起快照保存
save 60 10000
```

快照保存过程
redis调用fork创建新的线程，现在有了子进程和父进程两个进程。
父进程继续处理client请求，子进程负责将内存内容写入到临时文件。由于系统的写时复制机制父子进程会共享相同的物理页面，当父进程处理写请求时os会为父进程要修改的页面创建副本，而不是写共享的页面。所以子进程的地址空间内的数据是fork时刻整个数据库的一个快照。
当子进程将快照写入临时文件完毕后，用临时文件替换原来的快照文件，然后子进程退出。
AOF（只追加）文件:
aof 比快照方式有更好的持久化性，是由于在使用aof持久化方式时，redis会将每一个收到的“写命令”都通过write函数追加到文件中(默认是appendonly.aof)。当redis重启时会通过重新执行文件中保存的“写命令”，在内存中重建整个数据库的内容。当然由于os会在内核中缓存 write做的修改，所以可能不是立即写到磁盘上。这样aof方式的持久化也还是有可能会丢失部分修改。不过我们可以通过配置文件告诉redis我们想要通过fsync函数强制os写入到磁盘的时机。有三种方式如下（默认是：每秒fsync一次）
